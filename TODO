The retrieval queries are repeated, quite a bit, try and see if you
can organize this better to get code reused.
